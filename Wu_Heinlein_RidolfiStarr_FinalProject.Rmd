---
title: "Trend Analysis of Water Quality Data in Biscayne Bay: Impacts of City of Miami Beach Fertilizer Ordinance"
author: "Dashiell Ridolfi-Starr & Joy Wu & Jordan Heinlein"
date: "Fall 2025"
 
output: html_document
editor_options: 
  chunk_output_type: console
toc: TRUE
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup}
knitr::opts_chunk$set(echo = FALSE)

# Load packages
library(tidyverse) 
library(here) 
library(cowplot)
library(lubridate) 
library(zoo)
library(trend)
library(sf)
library(mapview); mapviewOptions(fgb = FALSE) 
library(cowplot)
library(agricolae)
library(knitr)

# Set working directory
here()

# Set ggplot theme
mytheme <- theme_classic(base_size = 13) +
  theme(axis.text = element_text(color = "black"),
        plot.background = element_rect(fill = "white", color = NA),
        legend.position = "right")
theme_set(mytheme)

# Load datasets
WQ_data_raw <- read.csv(here("./Raw_Data/WQ_data.txt"), header = TRUE, sep = "|",
                        colClasses = c("ProgramLocationID"="factor",
                                       "Year"="factor",
                                       "Month"="factor",
                                       "ParameterName"="factor"))

```


# Rationale and Research Questions
Urban coastal ecosystems are sensitive to stormwater runoff, which is rain water and waste water that flows over streets, sidewalks, and other surfaces. It picks up debris, oil, fertilizers, and other pollutants along the way before entering the stormwater system. The system is designed to drain cities of rain water and help minimize flooding. As a result, carries and deposits polluted runoff into surrounding waterways, causing harm to nearby ecossytems. Unfortunately, this is the case for Biscayne Bay near the City of Miami Beach. To address such issues, Miami-Dade County implemented an ordinance that prohibits the use of fertilizers containing nitrogen and phosphorus during the summer rainy season. The ordinance was passed in January, 2021, and was adopted in April of the same year. The ordinance is effective from May 15 through October 31 every year (accounting for raining season). 

This study examines whether measurable changes in nutrient concentrations or related indicators appeared following the implementation of the Miami-Dade County fertilizer ordinance by using data from the City of Miami Beach Water Monitoring Program. The goal is to quantify these changes through time series and statistical analyses. We chose to look at this specific dataset because it includes measurements for multiple years, and it is specific to the location that we are looking to assess. It also measures parameters that are crucial to our analyses, such as total nitrogen, total phosphorus, dissolved oxygen, and pH. 


\newpage

# Dataset Information

```{r include=FALSE}
#wrangling

#Insert underscores into parameter names
levels(WQ_data_raw$ParameterName) <- c("Dissolved_O2", "NO2_NO3_Filtered", "pH", 
                                    "Salinity", "Specific_Conductivity", 
                                    "Total_Kjeldahl_Nitrogen", "Total_Nitrogen",
                                    "Total_Phosphorous", "Turbidity", 
                                    "Water_Temperature")

#pivot parameteres
WQ_parameters_raw <- WQ_data_raw %>%
  #select  columns of interest
  select(SampleDate, ParameterName, ResultValue, Year, Month, ProgramLocationID,
         OriginalLatitude, OriginalLongitude) %>%
  group_by(SampleDate, Year, Month, ProgramLocationID, OriginalLatitude,
           OriginalLongitude, ParameterName) %>%
  summarise(
    mean_ResultValue = mean(ResultValue)) %>%
  #move parameters of interest into their own columns
  pivot_wider(names_from = ParameterName, values_from = mean_ResultValue) %>%
  mutate(SampleDate = ymd_hms(SampleDate),
         Group = ifelse(SampleDate < as.Date("2021-04-1"), "Pre", "Post"))


#monthly averages data frame (for time series)
WQ_monthly_data <- WQ_parameters_raw %>%
  group_by(Year, Month, Group) %>%
  summarise(
    Mean_Phosphorous = mean(Total_Phosphorous, na.rm=TRUE),
    Mean_pH = mean(pH, na.rm=TRUE),
    Mean_Dissolved_O2 = mean(Dissolved_O2, na.rm=TRUE),
    Mean_Total_N = mean(Total_Nitrogen, na.rm=TRUE)) %>%
  mutate_all(~ifelse(is.nan(.),NA,.)) %>%
  mutate(Date = ym(paste0(Year,"-",Month)))
  

#Find missing observations (needed for interpolation)
dates_by_month <- as.data.frame(seq.Date(from=as.Date("2016/08/01"),
                                      to=as.Date("2024/12/01"),
                                      by="month"))
colnames(dates_by_month) <- "Date"
WQ_monthly_complete <- left_join(dates_by_month, WQ_monthly_data)


#interpolate monthly data
WQ_monthly_complete <- WQ_monthly_complete %>%
  select(
    Date, Month, Mean_Phosphorous, Mean_Total_N, Mean_Dissolved_O2, Mean_pH) %>%
  mutate(
    Year = as.factor(year(Date)),
    Interp_Phosphorous = na.approx(Mean_Phosphorous),
    Interp_pH = na.approx(Mean_pH),
    Interp_Dissolved_O2 = na.approx(Mean_Dissolved_O2),
    Interp_Total_N = na.approx(Mean_Total_N),
    Group = ifelse(Date < as.Date("2021-04-01"), "Pre", "Post"))


#yearly numbers
yearly_averages <- WQ_parameters_raw %>%
  group_by(Year, Group) %>%
  summarise(
    Mean_Phosphorous = mean(Total_Phosphorous, na.rm=TRUE),
    Mean_pH = mean(pH, na.rm=TRUE),
    Mean_Dissolved_O2 = mean(Dissolved_O2, na.rm=TRUE),
    Mean_Total_N = mean(Total_Nitrogen, na.rm=TRUE)) %>%
  mutate(Date = ym(paste0(Year,"-","01")))

yearly_averages_bysite <- WQ_parameters_raw %>%
  group_by(Year, ProgramLocationID, OriginalLatitude, OriginalLongitude) %>%
  summarise(
    Mean_Phosphorous = mean(Total_Phosphorous, na.rm=TRUE),
    Mean_pH = mean(pH, na.rm=TRUE),
    Mean_Dissolved_O2 = mean(Dissolved_O2, na.rm=TRUE),
    Mean_Total_N = mean(Total_Nitrogen, na.rm=TRUE)) %>%
  mutate(Date = ym(paste0(Year,"-","01")))


#split data into pre- and post-ordinance data frames
pre_ordinance_monthly <- WQ_monthly_complete %>%
  filter(Group == "Pre")
  
post_ordinance_monthly <- WQ_monthly_complete %>%
  filter(Group == "Post")

pre_ordinance_yearly <- yearly_averages %>%
  filter(Group == "Pre")

post_ordinance_yearly <- yearly_averages %>%
  filter(Group == "Post")


#parameter summary table
Minima <- c(
  min(WQ_parameters_raw$Total_Phosphorous, na.rm=TRUE),
  min(WQ_parameters_raw$Total_Nitrogen, na.rm=TRUE),
  min(WQ_parameters_raw$Dissolved_O2, na.rm=TRUE),
  min(WQ_parameters_raw$pH, na.rm=TRUE))

Maxima <- c(
  max(WQ_parameters_raw$Total_Phosphorous, na.rm=TRUE),
  max(WQ_parameters_raw$Total_Nitrogen, na.rm=TRUE),
  max(WQ_parameters_raw$Dissolved_O2, na.rm=TRUE),
  max(WQ_parameters_raw$pH, na.rm=TRUE))

Means <- c(
  mean(WQ_parameters_raw$Total_Phosphorous, na.rm=TRUE),
  mean(WQ_parameters_raw$Total_Nitrogen, na.rm=TRUE),
  mean(WQ_parameters_raw$Dissolved_O2, na.rm=TRUE),
  mean(WQ_parameters_raw$pH, na.rm=TRUE))

SDs <- c(
  sd(WQ_parameters_raw$Total_Phosphorous, na.rm=TRUE),
  sd(WQ_parameters_raw$Total_Nitrogen, na.rm=TRUE),
  sd(WQ_parameters_raw$Dissolved_O2, na.rm=TRUE),
  sd(WQ_parameters_raw$pH, na.rm=TRUE))

parameter.summary <- data.frame(
  "Parameter" = c("Total Phosphorous", "Total Nitrogen", "Dissolved Oxygen", "pH"),
  "Units" = c("mg/L", "mg/L", "mg/L", "NA"),
  "Minimum" = Minima,
  "Maximum" = Maxima,
  "Mean" = Means,
  "Std_Deviation" = SDs)
```

Below are the raw data structure and a summary of the parameters examined in this project.
```{r echo=FALSE}
#displaying data

#raw data structure
str(WQ_data_raw)

#paramter summary
kable(
  parameter.summary,
  align = c("l","c","r","r","r","r"),
  digits = c(1,1,4,4,3,3),
  caption = "Parameter Summary Statistics")
```

# Data Wrangling

[insert wrangling description]

\newpage

# Exploratory Analysis 

```{r echo=FALSE}
#Creating simple features data frame for spatial visualization 
SampleLocations_sf <- WQ_data_raw %>%
  distinct(ProgramLocationID,OriginalLongitude, OriginalLatitude, .keep_all = FALSE) %>%
  st_as_sf(
    coords = c("OriginalLongitude", "OriginalLatitude"),
    crs= 4326)

#Visualization of sample collection locations 
mapviewOptions(basemaps = "Esri.WorldImagery")

mapview(
  SampleLocations_sf,
  layer.name= "Sample Locations",
  legend= FALSE,
  col.regions="blue",
  col="yellow",
  alpa.regions= 0.5
  )
```

[insert description of study area, anything else relevant]

Monthly averages of the study parameters are visualized below. The vertical dotted line represents the implementation of the Miami-Dade County summer fertilizer ordinance (April, 2021).
```{r echo=FALSE}
#Exploring series

phosphorous.preview <- ggplot(WQ_monthly_complete,
  aes(x=Date, y=Mean_Phosphorous)) +
  geom_line() +
  geom_smooth(method="lm", se=FALSE)+
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  labs(
    y="Dissolved Phosphorous (mg/L)",
    x="",
    title="Monthly Averages of Water Quality Parameters")

nitrogen.preview <- ggplot(WQ_monthly_complete,
  aes(x=Date, y=Mean_Total_N)) +
  geom_line() +
  geom_smooth(method="lm", se=FALSE)+
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  labs(
    y="Total Nitrogen (mg/L)",
    x="")

oxygen.preview <- ggplot(WQ_monthly_complete,
  aes(x=Date, y=Mean_Dissolved_O2)) +
  geom_line() +
  geom_smooth(method="lm", se=FALSE)+
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  labs(
    y="Dissolved Oxygen (mg/L)",
    x="")

pH.preview <- ggplot(WQ_monthly_complete,
  aes(x=Date, y=Mean_pH)) +
  geom_line() +
  geom_smooth(method="lm", se=FALSE)+
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  labs(
    y="pH",
    x="Date")

plot_grid(phosphorous.preview, nitrogen.preview, oxygen.preview, pH.preview, nrow=4, align='v')

```

[insert description of above plots]


Exploratory box plots showing the distribution of parameters of interest by year
individually and as a combined plot 
```{r echo=FALSE}

Total_Nitrogen_Distribution <- ggplot(WQ_monthly_complete,
            aes(x=Year,y=Mean_Total_N)
            )+
  geom_boxplot(na.rm= TRUE)+
  xlab("Year")+
  ylab("Total Nitrogen (mg/L)")+
  theme(axis.title.x = element_blank())+
  theme(axis.text.x = element_blank())+
  theme(axis.ticks.x = element_blank())

Total_Phosphorous_Distribution <- ggplot(WQ_monthly_complete,
            aes(x=as.factor(Year),y=Mean_Phosphorous)
            )+
  geom_boxplot(na.rm = TRUE)+
  xlab("Year")+
  ylab("TotalPhosphorous (mg/L)")+
  theme(axis.title.x = element_blank())+
  theme(axis.text.x = element_blank())+
  theme(axis.ticks.x = element_blank())


Dissolved_O2_Distribution <- ggplot(WQ_monthly_complete,
            aes(x=as.factor(Year),y=Mean_Dissolved_O2)
            )+
  geom_boxplot(na.rm = TRUE)+
  xlab("Year")+
  ylab("Dissolved O2 (mg/L)")+
  theme(axis.title.x = element_blank())+
  theme(axis.text.x = element_blank())+
  theme(axis.ticks.x = element_blank())


pH_distribution <- ggplot(WQ_monthly_complete,
            aes(x=as.factor(Year),y=Mean_pH)
            )+
  geom_boxplot(na.rm = TRUE)+
  xlab("Year")+
  ylab("pH")


CombinedDistributionPlot <- plot_grid(
  Total_Nitrogen_Distribution,
  Total_Phosphorous_Distribution,
  Dissolved_O2_Distribution,
  pH_distribution,
  ncol=1,
  align = "v"
)

print(CombinedDistributionPlot)
```

[insert description of boxplots]

\newpage

# Analysis

```{r echo=FALSE}
#time series

#P overall monthly ts
monthly.P.ts <- ts(WQ_monthly_complete$Interp_Phosphorous, start=c(2016,8), 
                   frequency=12)
monthly.P.decomp <- stl(monthly.P.ts, s.window="periodic")
plot(monthly.P.decomp)
monthly.P.components <- as.data.frame(monthly.P.decomp$time.series[,1:3])
monthly.P.components <- mutate(monthly.P.components,
                               observed = WQ_monthly_complete$Interp_Phosphorous,
                               date = WQ_monthly_complete$Date)

#N overall monthly ts
monthly.N.ts <- ts(WQ_monthly_complete$Interp_Total_N, start=c(2016,8), 
                   frequency=12)
monthly.N.decomp <- stl(monthly.N.ts, s.window="periodic")
plot(monthly.N.decomp)
monthly.N.components <- as.data.frame(monthly.N.decomp$time.series[,1:3])
monthly.N.components <- mutate(monthly.N.components,
                               observed = WQ_monthly_complete$Interp_Total_N,
                               date = WQ_monthly_complete$Date)


#O2 overall monthly ts
monthly.O.ts <- ts(WQ_monthly_complete$Interp_Dissolved_O2, start=c(2016,8),
                   frequency=12)
monthly.O.decomp <- stl(monthly.O.ts, s.window="periodic")
plot(monthly.O.decomp)
monthly.O.components <- as.data.frame(monthly.O.decomp$time.series[,1:3])
monthly.O.components <- mutate(monthly.O.components,
                               observed = WQ_monthly_complete$Interp_Dissolved_O2,
                               date = WQ_monthly_complete$Date)

#pH overall monthly ts
monthly.pH.ts <- ts(WQ_monthly_complete$Interp_pH, start=c(2016,8),
                   frequency=12)
monthly.pH.decomp <- stl(monthly.pH.ts, s.window="periodic")
plot(monthly.pH.decomp)
monthly.pH.components <- as.data.frame(monthly.pH.decomp$time.series[,1:3])
monthly.pH.components <- mutate(monthly.pH.components,
                               observed = WQ_monthly_complete$Interp_pH,
                               date = WQ_monthly_complete$Date)



#P pre vs. post monthly trend analysis
P.pre.ts <- ts(pre_ordinance_monthly$Interp_Phosphorous, start = c(2016,8),
               frequency=12)
P.pre.decomp <- stl(P.pre.ts, s.window="periodic") 
plot(P.pre.decomp)
P.pre.components <- as.data.frame(P.pre.decomp$time.series[,1:3])
P.pre.components <- mutate(P.pre.components,
                            observed = pre_ordinance_monthly$Interp_Phosphorous,
                            date = pre_ordinance_monthly$Date)
P.pre.smk <- smk.test(P.pre.ts) #no significant trend


P.post.ts <- ts(post_ordinance_monthly$Interp_Phosphorous, start = c(2021,4),
                frequency=12)
P.post.decomp <- stl(P.post.ts, s.window = "periodic")
plot(P.post.decomp)
P.post.components <- as.data.frame(P.post.decomp$time.series[,1:3])
P.post.components <- mutate(P.post.components,
                            observed = post_ordinance_monthly$Interp_Phosphorous,
                            date = post_ordinance_monthly$Date)
P.post.smk <- smk.test(P.post.ts) #significant trend! 

#P pre vs post plot
P.prevspost.plot <- ggplot() +
  geom_line(data=WQ_monthly_complete, aes(x=Date, y=Interp_Phosphorous)) +
  geom_line(data=P.pre.components, aes(x=date, y=trend), color="#005AB5") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2018-10-01"), y=0.02,
            label=paste0("SMK p-value = ", round(P.pre.smk$p.value, 3)), 
            color="#005AB5") +
  geom_line(data=P.post.components, aes(x=date, y=observed)) +
  geom_line(data=P.post.components, aes(x=date, y=trend), color="#DC3220") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2023-05-01"), y=0.04,
            label=paste0("SMK p-value = ", round(P.post.smk$p.value, 3), "*"),
            color="#DC3220") +
  geom_vline(xintercept = as.Date("2021-04-01"), lty=2) +
  labs(
    y="Total Phosphorous (mg/L)",
    #title="Comparing Pre- and Post-Ordinance Trends in Total Phosphorous",
    x="")
P.prevspost.plot

#N pre vs. post trend analysis
N.pre.ts <- ts(pre_ordinance_monthly$Interp_Total_N, start = c(2016,8),
               frequency=12)
N.pre.decomp <- stl(N.pre.ts, s.window="periodic") 
plot(N.pre.decomp)
N.pre.components <- as.data.frame(N.pre.decomp$time.series[,1:3])
N.pre.components <- mutate(N.pre.components,
                            observed = pre_ordinance_monthly$Interp_Total_N,
                            date = pre_ordinance_monthly$Date)
N.pre.smk <- smk.test(N.pre.ts) 


N.post.ts <- ts(post_ordinance_monthly$Interp_Total_N, start = c(2021,4),
                frequency=12)
N.post.decomp <- stl(N.post.ts, s.window = "periodic")
plot(N.post.decomp)
N.post.components <- as.data.frame(N.post.decomp$time.series[,1:3])
N.post.components <- mutate(N.post.components,
                            observed = post_ordinance_monthly$Interp_Total_N,
                            date = post_ordinance_monthly$Date)
N.post.smk <- smk.test(N.post.ts)

#N pre vs post plot
N.prevspost.plot <- ggplot() +
  geom_line(data=WQ_monthly_complete, aes(x=Date, y=Interp_Total_N)) +
  geom_line(data=N.pre.components, aes(x=date, y=trend), color="#005AB5") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2018-10-01"), y=0.8,
            label=paste0("SMK p-value = ", round(N.pre.smk$p.value, 3)), 
            color="#005AB5") +
  geom_line(data=N.post.components, aes(x=date, y=observed)) +
  geom_line(data=N.post.components, aes(x=date, y=trend), color="#DC3220") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2023-01-01"), y=0.8,
            label=paste0("SMK p-value = ", round(N.post.smk$p.value, 3)),
            color="#DC3220") +
  geom_vline(xintercept = as.Date("2021-04-01"), lty=2) +
  labs(
    y="Total Nitrogen (mg/L)",
    x="")
N.prevspost.plot

#O2 pre vs. post trend analysis
O.pre.ts <- ts(pre_ordinance_monthly$Interp_Dissolved_O2, start = c(2016,8),
               frequency=12)
O.pre.decomp <- stl(O.pre.ts, s.window="periodic") 
plot(O.pre.decomp)
O.pre.components <- as.data.frame(O.pre.decomp$time.series[,1:3])
O.pre.components <- mutate(O.pre.components,
                            observed = pre_ordinance_monthly$Interp_Dissolved_O2,
                            date = pre_ordinance_monthly$Date)
O.pre.smk <- smk.test(O.pre.ts) 


O.post.ts <- ts(post_ordinance_monthly$Interp_Dissolved_O2, start = c(2021,4),
                frequency=12)
O.post.decomp <- stl(O.post.ts, s.window = "periodic")
plot(O.post.decomp)
O.post.components <- as.data.frame(O.post.decomp$time.series[,1:3])
O.post.components <- mutate(O.post.components,
                            observed = post_ordinance_monthly$Interp_Dissolved_O2,
                            date = post_ordinance_monthly$Date)
O.post.smk <- smk.test(O.post.ts)

#O2 pre vs post plot
O.prevspost.plot <- ggplot() +
  geom_line(data=WQ_monthly_complete, aes(x=Date, y=Interp_Dissolved_O2)) +
  geom_line(data=O.pre.components, aes(x=date, y=trend), color="#005AB5") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2019-09-01"), y=75,
            label=paste0("SMK p-value = ",round(O.pre.smk$p.value, 2)), 
            color="#005AB5") +
  geom_line(data=O.post.components, aes(x=date, y=observed)) +
  geom_line(data=O.post.components, aes(x=date, y=trend), color="#DC3220") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2023-05-01"), y=75,
            label=paste0("SMK p-value = ", round(O.post.smk$p.value, 2)),
            color="#DC3220") +
  geom_vline(xintercept = as.Date("2021-04-01"), lty=2) +
  labs(
    y="Dissolved Oxygen (mg/L)",
    x="")
O.prevspost.plot

#pH pre vs. post trend analysis
pH.pre.ts <- ts(pre_ordinance_monthly$Interp_pH, start = c(2016,8),
               frequency=12)
pH.pre.decomp <- stl(pH.pre.ts, s.window="periodic") 
plot(pH.pre.decomp)
pH.pre.components <- as.data.frame(pH.pre.decomp$time.series[,1:3])
pH.pre.components <- mutate(pH.pre.components,
                            observed = pre_ordinance_monthly$Interp_pH,
                            date = pre_ordinance_monthly$Date)
pH.pre.smk <- smk.test(pH.pre.ts) 


pH.post.ts <- ts(post_ordinance_monthly$Interp_pH, start = c(2021,4),
                frequency=12)
pH.post.decomp <- stl(pH.post.ts, s.window = "periodic")
plot(pH.post.decomp)
pH.post.components <- as.data.frame(pH.post.decomp$time.series[,1:3])
pH.post.components <- mutate(pH.post.components,
                            observed = post_ordinance_monthly$Interp_pH,
                            date = post_ordinance_monthly$Date)
pH.post.smk <- smk.test(pH.post.ts)

#pH pre vs post plot
pH.prevspost.plot <- ggplot() +
  geom_line(data=WQ_monthly_complete, aes(x=Date, y=Interp_pH)) +
  geom_line(data=pH.pre.components, aes(x=date, y=trend), color="#005AB5") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2019-03-01"), y=8.75,
            label=paste0("SMK p-value = ",round(pH.pre.smk$p.value, 2)), 
            color="#005AB5") +
  geom_line(data=pH.post.components, aes(x=date, y=observed)) +
  geom_line(data=pH.post.components, aes(x=date, y=trend), color="#DC3220") +
  geom_text(data=WQ_monthly_complete,
            x=as.Date("2023-05-01"), y=9.5,
            label=paste0("SMK p-value = ", round(pH.post.smk$p.value, 2),"*"),
            color="#DC3220") +
  geom_vline(xintercept = as.Date("2021-04-01"), lty=2) +
  ylim(6.5,10) +
  labs(
    y="pH")
pH.prevspost.plot

#combined pre vs post trend analysis plot
plot_grid(P.prevspost.plot, N.prevspost.plot, O.prevspost.plot, pH.prevspost.plot,
          nrow=4)

#pre vs post SMK results summary table
pre.stat.summary <- c(P.pre.smk$statistic, N.pre.smk$statistic, 
                   O.pre.smk$statistic, pH.pre.smk$statistic)
pre.pvalue.summary <- c(P.pre.smk$p.value, N.pre.smk$p.value,
                        O.pre.smk$p.value, pH.pre.smk$p.value)
post.stat.summary <- c(P.post.smk$statistic, N.post.smk$statistic,
                       O.post.smk$statistic, pH.post.smk$statistic)
post.pvalue.summary <- c(P.post.smk$p.value, N.post.smk$p.value,
                        O.post.smk$p.value, pH.post.smk$p.value)

prevspost.SMK.summary <- data.frame(
  "Pre-Ordinance_Z.Stat" = pre.stat.summary,
  "Pre-Ordinance_p-value" = pre.pvalue.summary,
  "Post-Ordinance_Z.Stat" = post.stat.summary,
  "Post-Ordinance_p-value" = post.pvalue.summary,
  row.names = c("Total_Phosphorous", "Total_Nitrogen", "Dissolved_Oxygen", "pH"))

#smk summary table
kable(prevspost.SMK.summary, 
      digits=c(3,3,3,3),
      caption="Summary of Pre- and Post-Ordinance SMK Results")
```

[insert description of TS plots & SMK results]


```{r echo=FALSE}
#yearly TS with combined plots
par(mfrow = c(2,2))
yearly.P.ts <- ts(yearly_averages$Mean_Phosphorous, 
                  start = 2016,
                  frequency = 1)
plot(yearly.P.ts,
     xlab = "Year",
     ylab = "Phosphorous (mg/L)")

yearly.N.ts <- ts(yearly_averages$Mean_Total_N, 
                  start = 2016,
                  frequency = 1)
plot(yearly.N.ts,
     xlab = "Year",
     ylab = "Nitrogen (mg/L)")

yearly.O.ts <- ts(yearly_averages$Mean_Dissolved_O2, 
                  start = 2016,
                  frequency = 1)
plot(yearly.O.ts,
      xlab = "Year",
     ylab = "Dissolved Oxygen (mg/L)")

yearly.pH.ts <- ts(yearly_averages$Mean_pH, 
                  start = 2016,
                  frequency = 1)
plot(yearly.pH.ts,
     xlab = "Year",
     ylab = "pH")
par(mfrow = c(1,1))

#comparison of monthly interpolated TS & yearly non-interpolated TS
#Phosphorous
P.yearly.plot <- ggplot() +
  geom_line(data=yearly_averages, aes(x=Date, y=Mean_Phosphorous)) +
  geom_line() +
  geom_point() +
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  #scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  labs(
    x = "Year",
    y = "Phosphorous (mg/L)",
    title = "Yearly Mean Total Phosphorous")
P.yearly.plot
  
plot_grid(P.prevspost.plot, P.yearly.plot,
          nrow=2,
          align = "v")

#Nitrogen
N.yearly.plot <- ggplot() +
  geom_line(data=yearly_averages, aes(x=Date, y=Mean_Total_N)) +
  geom_line() +
  geom_point() +
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  #scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  labs(
    x = "Year",
    y = "Nitrogen (mg/L)",
    title = "Yearly Mean Total Nitrogen")
N.yearly.plot

plot_grid(N.prevspost.plot, N.yearly.plot,
          nrow=2,
          align = "v")

O.yearly.plot <- ggplot() +
  geom_line(data=yearly_averages, aes(x=Date, y=Mean_Dissolved_O2)) +
  geom_line() +
  geom_point() +
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  #scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  labs(
    x = "Year",
    y = "Dissolved Oxygen (mg/L)",
    title = "Yearly Mean Total Dissolved Oxygen")
O.yearly.plot

plot_grid(O.prevspost.plot, O.yearly.plot,
          nrow=2,
          align = "v")

pH.yearly.plot <- ggplot() +
  geom_line(data=yearly_averages, aes(x=Date, y=Mean_pH)) +
  geom_line() +
  geom_point() +
  geom_vline(xintercept = as.Date("2021-04-01"), lty = 2) +
  #scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  labs(
    x = "Year",
    y = "pH",
    title = "Yearly Mean pH")
pH.yearly.plot

plot_grid(pH.prevspost.plot, pH.yearly.plot,
          nrow=2,
          align = "v")

#MK test on yearly ts
P.mk <- mk.test(yearly.P.ts)
N.mk <- mk.test(yearly.N.ts)
O.mk <- mk.test(yearly.O.ts)
pH.mk <- mk.test(yearly.pH.ts)

mk.stat.summary <- 
  c(P.mk$statistic,N.mk$statistic,O.mk$statistic,pH.mk$statistic)
mk.pvalue.summary <-
  c(P.mk$p.value,N.mk$p.value,O.mk$p.value,pH.mk$p.value)

mk.summary <- data.frame(
  "S.Stat" = mk.stat.summary,
  "p.value" = mk.pvalue.summary,
  row.names = c("Total_Phosphorous", "Total_Nitrogen", "Dissolved_O2", "pH"))

kable(mk.summary,
      digits=c(3,3),
      caption="Summary of Mann Kendall Results for Yearly Averages")
```

[insert description of yearly TS vs interpolated plots, MK results]


```{r echo=FALSE}
#ANOVA
yearly.P.anova <- aov(data=WQ_monthly_complete, Mean_Phosphorous ~ Year)
summary(yearly.P.anova)
TukeyHSD(yearly.P.anova)
P.HSD <- HSD.test(yearly.P.anova, "Year", group=TRUE)
P.HSD

yearly.N.anova <- aov(data=WQ_monthly_complete, Mean_Total_N ~ Year)
summary(yearly.N.anova)
TukeyHSD(yearly.N.anova)
N.HSD <- HSD.test(yearly.N.anova, "Year", group=TRUE)
N.HSD

yearly.O.anova <- aov(data=WQ_monthly_complete, Mean_Dissolved_O2 ~ Year)
summary(yearly.O.anova)
TukeyHSD(yearly.O.anova)
O.HSD <- HSD.test(yearly.O.anova, "Year", group=TRUE)
O.HSD

yearly.pH.anova <- aov(data=WQ_monthly_complete, Mean_pH ~ Year)
summary(yearly.pH.anova)
TukeyHSD(yearly.pH.anova)
pH.HSD <- HSD.test(yearly.pH.anova, "Year", group=TRUE)
pH.HSD

#anova results table
P.anova.results <- summary(yearly.P.anova)[[1]]
N.anova.results <- summary(yearly.N.anova)[[1]]
O.anova.results <- summary(yearly.O.anova)[[1]]
pH.anova.results <- summary(yearly.pH.anova)[[1]]

anova.results <- bind_rows(
  P.anova.results,
  N.anova.results,
  O.anova.results,
  pH.anova.results)

anova.results <- anova.results %>%
  mutate(Parameter = c(
    "Total_Phosphorous", "Total_Phosphorous", "Total_Nitrogen", "Total_Nitrogen",
    "Dissolved_O2", "Dissolved_O2", "pH", "pH")) %>%
  select(Parameter, Df, `Sum Sq`, `Mean Sq`, `F value`, `Pr(>F)`)
 
kable(anova.results,
      row.names = T,
      digits = c(1,1,3,3,3,5),
      caption="Summary of ANOVA Results")

#HSD results into table
P.groups <- as.data.frame(P.HSD$groups)
N.groups <- as.data.frame(N.HSD$groups)
O.groups <- as.data.frame(O.HSD$groups)
pH.groups <- as.data.frame(pH.HSD$groups)

parameter.anova.groups <- data.frame(
  "Phosphorous" = P.groups,
  "Nitrogen" = N.groups,
  "Dissolved_O2"= O.groups,
  "pH" = pH.groups)

kable(parameter.anova.groups,
      col.names=c("Year","Phosphorous_Mean","P_Group","Nitrogen_Mean","N_Group",
                  "Diss_O2_Mean","O2_Group","pH_Mean","pH_Group"),
            align=c("r","c","r","c","r","c","r","c"),
      digits=c(3,1,3,1,3,1,3,1,3),
      caption="Summary of Tukey's HSD Test Results")
```

[insert ANOVA results]

## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
https://data.florida-seacar.org/programs/details/4058 
